## 21장. 저장프로시저 함수 커서

4. **부서번호를 전달하여 해당 부서의 이름과 사원수, 최고 급여, 평균 급여를 구해보세요.(FOR~IN 사용합니다.)**

```sql
CREATE OR REPLACE PROCEDURE CURSOR_TEST(
    VDEPTNO IN EMP.DEPTNO%TYPE
) IS
    VEMPCOUNT NUMBER;
BEGIN
    SELECT COUNT(*) INTO VEMPCOUNT FROM EMP WHERE DEPTNO = VDEPTNO;

    IF VEMPCOUNT = 0 THEN
        DBMS_OUTPUT.PUT_LINE('There is no employees in Dept ' || VDEPTNO || '.');
    ELSE
        FOR VEMP IN (SELECT DNAME, MAX(SAL) MAXSAL, ROUND(AVG(SAL), 2) AVGSAL
                     FROM EMP
                              NATURAL JOIN DEPT
                     WHERE DEPTNO = VDEPTNO
                     GROUP BY DEPTNO, DNAME)
            LOOP
                DBMS_OUTPUT.PUT_LINE('DNAME : ' || VEMP.DNAME);
                DBMS_OUTPUT.PUT_LINE('EMP_COUNT : ' || VEMPCOUNT);
                DBMS_OUTPUT.PUT_LINE('MAX_SAL : ' || VEMP.MAXSAL);
                DBMS_OUTPUT.PUT_LINE('AVG_SAL : ' || VEMP.AVGSAL);
            END LOOP;
    END IF;
END;
/
```



---



## 22장. 패키지와 트리거

1. **<탄탄히 다지기> DEPT01 테이블에 UPDATE가 되면 자동으로 TEMP에 이전 데이터를 저장하는 트리거**

```sql
CREATE OR REPLACE TRIGGER DEPT01_UPDATE
    AFTER UPDATE
    ON DEPT01
    FOR EACH ROW
BEGIN
    INSERT INTO TEMP VALUES (:OLD.DEPTNO, :OLD.DNAME, :OLD.LOC);
END;
/
```



2. **<탄탄히 다지기> 성적 트리거 작성하기**

- GRADECARD 테이블에 데이터를 입력하면 TOT, AVG, GRADE를 자동으로 구하는 트리거를 작성해 보세요.

- INSERT INTO GRADECARD(NO, NAME, KOR, ENG, MATH) VALUES ( GRADECARD_SEQ.NEXTVAL, 'TEST1', 90, 90, 90);

- TEST > SELECT * FROM GRADECARD;

  NO NAME KOR ENG MAT TOT AVG GRADE

  -------------------------------------------------------------

  15, TEST2, 90, 90, 90, 270, 90, A0

```sql
-- CREATE SEQUENCE ( GRADECARD_SEQ.sql )
CREATE SEQUENCE GRADECARD_SEQ
    START WITH 1
    INCREMENT BY 1;
    
-- CREATE FUNCTION ( CAL_GRADE_FUNC.sql )
CREATE OR REPLACE FUNCTION CAL_GRADE(
    VSCORE IN GRADECARD.AVG%TYPE)
    RETURN VARCHAR2
    IS
    VGRADE VARCHAR2(4);
BEGIN
    SELECT GRADE
    INTO VGRADE
    FROM GRADE
    WHERE VSCORE BETWEEN LOWSCORE AND HISCORE;

    RETURN VGRADE;
END;
/

-- CREATE TRIGGER ( TRIG_GRADE.sql )
CREATE OR REPLACE TRIGGER TRIG_GRADE
    BEFORE INSERT
    ON GRADECARD
    FOR EACH ROW
BEGIN
    :NEW.TOT := :NEW.KOR + :NEW.ENG + :NEW.MAT;
    :NEW.AVG := ROUND(:NEW.TOT / 3);
    :NEW.GRADE := CAL_GRADE(:NEW.AVG);

    UPDATE GRADECARD
    SET TOT   = :NEW.TOT,
        AVG   = :NEW.AVG,
        GRADE = :NEW.GRADE
    WHERE NO = :NEW.NO;
END;
/

-- SEQUENCE, FUNCTION, TRIGGER sql파일 실행하기
SCOTT > @GRADECARD_SEQ
Sequence created.

SCOTT > @CAL_GRADE_FUNC
Function created.

SCOTT > @TRIG_GRADE
Trigger created.

-- GRADECARD에 insert문 수행
INSERT INTO GRADECARD(NO, NAME, KOR, ENG, MAT) VALUES (GRADECARD_SEQ.NEXTVAL, 'TEST1', 90, 90, 90);
```



---



## 게시판 쿼리 

1. **사용자 board/1234 생성합니다.**

```sql
CREATE USER board IDENTIFIED BY 1234;
-- grant resource, connect to board;

```



2. **테이블 생성**

```sql
CREATE TABLE BOARD
(
    BOARD_NUM       NUMBER(5),      -- 글번호(기본키)
    BOARD_NAME      VARCHAR2(30),   -- 작성자
    BOARD_PASS      VARCHAR2(30),   -- 비밀번호
    BOARD_SUBJECT   VARCHAR2(300),  -- 제목
    BOARD_CONTENT   VARCHAR2(4000), -- 내용
    BOARD_FILE      VARCHAR2(50),   -- 첨부될 파일 명(시스템에 저장되는 파일명)
    BOARD_ORIGINAL  VARCHAR2(50),   -- 첨부될 파일 명(시스템에 저장된 파일의 원래 파일명)
    BOARD_RE_REF    NUMBER(5),      -- 답변 글 작성시 참조되는 글의 번호
    BOARD_RE_LEV    NUMBER(5),      -- 답변 글의 깊이(원문 글:0, 답변:1, 답변의답변:2)
    BOARD_RE_SEQ    NUMBER(5),      -- 답변 글의 순서(원문 글 기준으로 보여주는 순서)
    BOARD_READCOUNT NUMBER(5),      -- 글의 조회수
    BOARD_DATE      DATE,           -- 글의작성날짜
    PRIMARY KEY (BOARD_NUM)
);
```



3. **글 번호는 시퀀스를 사용합니다.**

```sql
-- 시퀀스 이름 : board_seq
-- 시작값 : 1
-- 증가값 : 1
CREATE SEQUENCE BOARD_SEQ
    START WITH 1
    INCREMENT BY 1;
```



4. **테이블 조회와 같이 원문글이 저장되도록 INSERT문을 작성하세요.**

```sql
-- 조건1) 원문글의 경우 BOARD_RE_REF 컬럼의 값은 원문 글 번호와 같습니다. 
-- 조건2) BOARD_RE_LEV,BOARD_RE_SEQ,BOARD_READCOUNT 값은 모두 0 입니다. 
-- 조건3) BOARD_DATE는 시스템 날짜입니다.
-- 조건4) BOARD_FILE, BOARD_ORIGINAL는 null로 처리합니다.
-- 조건5) 비밀번호 삽입은 하지만 조회 시 제외합니다.
INSERT INTO BOARD
VALUES ( BOARD_SEQ.NEXTVAL -- BOARD_NUM
       , 'admin' -- BOARD_NAME
       , 'admin_pass' -- BOARD_PASS
       , 'JSP 공부는 재미있어요' -- BOARD_SUBJECT
       , '열심히 해봐요' -- BOARD_CONTENT
       , NULL -- BOARD_FILE
       , NULL -- BOARD_ORIGINAL
       , BOARD_SEQ.CURRVAL -- BOARD_RE_REF
       , 0 -- BOARD_RE_LEV
       , 0 -- BOARD_RE_SEQ
       , 0 -- BOARD_READCOUNT
       , SYSDATE -- BOARD_DATE
       );
```

| BOARD\_NUM | BOARD\_NAME | BOARD\_PASS | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--------- | :---------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1          | admin       | admin\_pass | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:01:16 |



5. **원문글에 답변을 달도록 쿼리문을 작성하세요.(INSERT문)**

```sql
-- 조건1) 글 번호는 시퀀스로 증가합니다.
-- 조건2) BOARD_RE_REF 컬럼의 값은 원문글의 글 번호와 일치합니다.
-- 조건3) BOARD_RE_LEV,BOARD_RE_SEQ는 원문글의 BOARD_RE_LEV,BOARD_RE_SEQ 보다 1씩 증가합니다. 
-- 조건4) BOARD_DATE는 시스템 날짜입니다.
INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       'JAVA도',
       'JAVA도',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 1; -- 1은 원문의 BOARD_NUM
```

| BOARD\_NUM | BOARD\_NAME | BOARD\_PASS | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--------- | :---------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1          | admin       | admin\_pass | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:01:16 |
| 2          | admin       | admin\_pass | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:01:55 |



6. **테이블 조회는 BOARD_RE_REF를 기준으로 내림차순으로 정렬하고, BOARD_RE_REF 같으면 BOARD_RE_SEQ를 오름차순 기준으로 정렬합니다. 정렬기준으로 처음부터 10개를 조회합니다.(SELECT문 사용)**

```sql
SELECT ROWNUM AS RNUM
     , BOARD_NUM
     , BOARD_NAME
     , BOARD_SUBJECT
     , BOARD_CONTENT
     , BOARD_FILE
     , BOARD_ORIGINAL
     , BOARD_RE_REF
     , BOARD_RE_LEV
     , BOARD_RE_SEQ
     , BOARD_READCOUNT
     , BOARD_DATE
FROM (SELECT *
      FROM BOARD
      ORDER BY BOARD_RE_REF DESC, BOARD_RE_SEQ)
WHERE ROWNUM <= 10;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:01:16 |
| 2    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:01:55 |



🤕🤕🤕

7. **원문글에 답변을 추가하는 경우 기존 글들의 BOARD_RE_SEQ는 1증가합니다. (UPDATE문 사용)**

```sql
-- 조건) BOARD_RE_REF가 원문글의 번호이고
-- BOARD_RE_SEQ값이 원문글의 BOARD_RE_SEQ보다 큰 경우에만 답변의 BOARD_RE_SEQ는 1증가합니다
UPDATE BOARD
SET BOARD_RE_SEQ = BOARD_RE_SEQ + 1
WHERE BOARD_RE_REF = 1
  AND BOARD_NUM <> BOARD_RE_REF
  AND BOARD_RE_SEQ > (SELECT BOARD_RE_SEQ
                      FROM BOARD
                      WHERE BOARD_NUM = 1)
```

| BOARD\_NUM | BOARD\_SUBJECT        | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ |
| :--------- | :-------------------- | :------------- | :------------- | :------------- |
| 1          | JSP 공부는 재미있어요 | 1              | 0              | 0              |
| 2          | JAVA도                | 1              | 1              | 2              |



8. **원문글(BOARD_NUM=1)에 답변을 추가로 달도록 쿼리문을 작성합니다.(INSERT문)**
   **(최신의 답변글이 원문글 바로 아래 위치합니다.)**

```sql
INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       '나도 찬성',
       '찬성입니다.',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 1;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:12:35 |
| 2    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:12:58 |
| 3    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:12:39 |



9. **글 번호 2(BOARD_NUM=2)에 답변을 답니다.(INSERT 문)**

```sql
-- 조건1) BOARD_RE_REF는 원문글번호를 가집니다.
-- 조건2) BOARD_RE_LEV는 글번호 2의 BOARD_RE_LEV 보다 1 증가합니다. 
-- 조건3) BOARD_RE_SEQ는 글번호 2의 BOARD_RE_SEQ 보다 1증가합니다.
INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       '나도 찬성이요',
       '찬성',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 2;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 2    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:24:24 |
| 3    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:15 |
| 4    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 3              | 0                | 2024-08-26 15:25:12 |



10. **원문글(BOARD_NUM=1)에 답변을 답니다.다음 조건에 맞는 쿼리문을 작성하세요(UPDATE)**

```sql
-- 조건1) 글 번호 3,2,4의 BOARD_RE_SEQ는 기존의 값에서 1씩 증가합니다. 
-- BOARD_RE_REF의 값이 원문글 번호이고
-- BOARD_RE_SEQ값이 원문글의 BOARD_RE_SEQ보다 큰 경우에만 답변의 BOARD_RE_SEQ는 1증가합니다.
UPDATE BOARD
SET BOARD_RE_SEQ = BOARD_RE_SEQ + 1
WHERE BOARD_RE_REF = 1
  AND BOARD_NUM <> BOARD_RE_REF
  AND BOARD_RE_SEQ > (SELECT BOARD_RE_SEQ
                      FROM BOARD
                      WHERE BOARD_NUM = 1)
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 2    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 3    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 3              | 0                | 2024-08-26 15:24:15 |
| 4    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 4              | 0                | 2024-08-26 15:25:12 |

```sql
-- 조건2) 새로 입력하는 답변글의 BOARD_RE_REF는 원문글 번호 입니다.(INSERT) 
-- BOARD_RE_LEV는 원문글의 BOARD_RE_LEV보다 1증가 합니다. 
-- BOARD_RE_SEQ 는 원문글의 BOARD_RE_SEQ 보다 1증가 합니다.
INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       '저도요',
       '저도요',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 1;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 2    | 5          | admin       | 저도요                | 저도요         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:33:16 |
| 3    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 4    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 3              | 0                | 2024-08-26 15:24:15 |
| 5    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 4              | 0                | 2024-08-26 15:25:12 |



11. **원문 글 삽입**

```sql
INSERT INTO BOARD
VALUES ( BOARD_SEQ.NEXTVAL -- BOARD_NUM
       , 'admin' -- BOARD_NAME
       , 'admin_pass' -- BOARD_PASS
       , '힘내세요' -- BOARD_SUBJECT
       , '힘내세요' -- BOARD_CONTENT
       , NULL -- BOARD_FILE
       , NULL -- BOARD_ORIGINAL
       , BOARD_SEQ.CURRVAL -- BOARD_RE_REF
       , 0 -- BOARD_RE_LEV
       , 0 -- BOARD_RE_SEQ
       , 0 -- BOARD_READCOUNT
       , SYSDATE -- BOARD_DATE
       );
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 6          | admin       | 힘내세요              | 힘내세요       | null        | null            | 6              | 0              | 0              | 0                | 2024-08-26 15:36:08 |
| 2    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 3    | 5          | admin       | 저도요                | 저도요         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:33:16 |
| 4    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 5    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 3              | 0                | 2024-08-26 15:24:15 |
| 6    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 4              | 0                | 2024-08-26 15:25:12 |



12. **6번글에 답변을 달아요.**

```sql
-- 🤕🤕🤕 6번글에 대해 존재하던 답변이 없어서 아래 쿼리 수행해도 변화 없음
-- 기존재하는 답변이 있었다면, update문의 where절에 의해서 BOARD_RE_SEQ가 update됬을것.
UPDATE BOARD
SET BOARD_RE_SEQ = BOARD_RE_SEQ + 1
WHERE BOARD_RE_REF = (SELECT BOARD_RE_REF
                      FROM BOARD
                      WHERE BOARD_NUM = 6)
  AND BOARD_RE_SEQ > (SELECT BOARD_RE_SEQ
                      FROM BOARD
                      WHERE BOARD_NUM = 6)
  AND BOARD_NUM <> BOARD_RE_REF;

INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       'Re: 힘내세요',
       'Re: 힘내세요',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 6;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 6          | admin       | 힘내세요              | 힘내세요       | null        | null            | 6              | 0              | 0              | 0                | 2024-08-26 15:36:08 |
| 2    | 7          | admin       | Re: 힘내세요          | 운동하세요.    | null        | null            | 6              | 1              | 1              | 0                | 2024-08-26 15:44:20 |
| 3    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 4    | 5          | admin       | 저도요                | 저도요         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:33:16 |
| 5    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 6    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 3              | 0                | 2024-08-26 15:24:15 |
| 7    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 4              | 0                | 2024-08-26 15:25:12 |



13. **3번 글에 대한 답변을 답니다.**

```sql
-- 조건1) 2, 4번 글에 대한 BOARD_RE_SEQ를 기존 값에서 1증가 합니다. (8번 참조)
-- 조건2) 8번 글의 BOARD_RE_REF는 1, BOARD_RE_LEV은 답변의 답변이므로 2, BOARD_RE_SEQ는 3번 글의 답변이므로 3번 글의 BOARD_RE_SEQ보다 1증가 합니다.
-- 즉, 답변은 답변을 다는 글의 BOARD_RE_LEV, BOARD_RE_SEQ 보다 각각 1씩 증가합니다.
UPDATE BOARD
SET BOARD_RE_SEQ = BOARD_RE_SEQ + 1
WHERE BOARD_RE_REF = (SELECT BOARD_RE_REF
                      FROM BOARD
                      WHERE BOARD_NUM = 3)
  AND BOARD_RE_SEQ > (SELECT BOARD_RE_SEQ
                      FROM BOARD
                      WHERE BOARD_NUM = 3)
  AND BOARD_NUM <> BOARD_RE_REF;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 6          | admin       | 힘내세요              | 힘내세요       | null        | null            | 6              | 0              | 0              | 0                | 2024-08-26 15:36:08 |
| 2    | 7          | admin       | Re: 힘내세요          | 운동하세요     | null        | null            | 6              | 1              | 1              | 0                | 2024-08-26 15:44:20 |
| 3    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 4    | 5          | admin       | 저도요                | 저도요         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:33:16 |
| 5    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 6    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 4              | 0                | 2024-08-26 15:24:15 |
| 7    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 5              | 0                | 2024-08-26 15:25:12 |

```sql
-- 조건2) 8번 글의 BOARD_RE_REF는 1, BOARD_RE_LEV은 답변의 답변이므로 2, 
--       BOARD_RE_SEQ는 3번 글의 답변이므로 3번 글의 BOARD_RE_SEQ보다 1증가 합니다.
-- 즉, 답변은 답변을 다는 글의 BOARD_RE_LEV, BOARD_RE_SEQ 보다 각각 1씩 증가합니다.
INSERT INTO BOARD
SELECT BOARD_SEQ.NEXTVAL,
       'admin',
       'admin_pass',
       'RE: 나도 찬성',
       '하하',
       NULL,
       NULL,
       BOARD_RE_REF,
       BOARD_RE_LEV + 1,
       BOARD_RE_SEQ + 1,
       0,
       SYSDATE
FROM BOARD
WHERE BOARD_NUM = 3;
```

| RNUM | BOARD\_NUM | BOARD\_NAME | BOARD\_SUBJECT        | BOARD\_CONTENT | BOARD\_FILE | BOARD\_ORIGINAL | BOARD\_RE\_REF | BOARD\_RE\_LEV | BOARD\_RE\_SEQ | BOARD\_READCOUNT | BOARD\_DATE         |
| :--- | :--------- | :---------- | :-------------------- | :------------- | :---------- | :-------------- | :------------- | :------------- | :------------- | :--------------- | :------------------ |
| 1    | 6          | admin       | 힘내세요              | 힘내세요       | null        | null            | 6              | 0              | 0              | 0                | 2024-08-26 15:36:08 |
| 2    | 7          | admin       | Re: 힘내세요          | 운동하세요     | null        | null            | 6              | 1              | 1              | 0                | 2024-08-26 15:44:20 |
| 3    | 1          | admin       | JSP 공부는 재미있어요 | 열심히 해봐요  | null        | null            | 1              | 0              | 0              | 0                | 2024-08-26 15:24:13 |
| 4    | 5          | admin       | 저도요                | 저도요         | null        | null            | 1              | 1              | 1              | 0                | 2024-08-26 15:33:16 |
| 5    | 3          | admin       | 나도 찬성             | 찬성입니다.    | null        | null            | 1              | 1              | 2              | 0                | 2024-08-26 15:24:24 |
| 6    | 8          | admin       | RE: 나도 찬성         | 하하           | null        | null            | 1              | 2              | 3              | 0                | 2024-08-26 16:01:20 |
| 7    | 2          | admin       | JAVA도                | JAVA도         | null        | null            | 1              | 1              | 4              | 0                | 2024-08-26 15:24:15 |
| 8    | 4          | admin       | 나도 찬성이요         | 찬성           | null        | null            | 1              | 2              | 5              | 0                | 2024-08-26 15:25:12 |



**삭제의 조건)**
	**조건1) 해당 글이 원문글인 경우 이 원문글의 BOARD_RE_REF와 같은 글들을 삭제합니다.**
	**조건2) 해당 글이 원문글이 아닌 경우 자신과 자신의 하위 레벨 답변글들도 삭제합니다.**



14. **글 번호 2번을 삭제하면 4번 글이 삭제되도록 합니다. ( 글 번호 3번을 삭제하면 8번글도 삭제됩니다. )**

```sql
// TO-DO
```



15. **글 번호 4번을 삭제하면 4버 글만 삭제됩니다.**

```sql
// TO-DO
```



16. **글 번호 1번을 삭제하면 2, 3, 4, 5, 8번 글이 삭제됩니다.**

```sql
// TO-DO
```

