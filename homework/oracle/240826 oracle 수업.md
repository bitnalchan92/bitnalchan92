## 21장. 저장프로시저 함수 커서

4. **부서번호를 전달하여 해당 부서의 이름과 사원수, 최고 급여, 평균 급여를 구해보세요.(FOR~IN 사용합니다.)**

```sql
CREATE OR REPLACE PROCEDURE CURSOR_TEST(
    VDEPTNO IN EMP.DEPTNO%TYPE
) IS
    VEMPCOUNT NUMBER;
BEGIN
    SELECT COUNT(*) INTO VEMPCOUNT FROM EMP WHERE DEPTNO = VDEPTNO;

    IF VEMPCOUNT = 0 THEN
        DBMS_OUTPUT.PUT_LINE('There is no employees in Dept ' || VDEPTNO || '.');
    ELSE
        FOR VEMP IN (SELECT DNAME, MAX(SAL) MAXSAL, ROUND(AVG(SAL), 2) AVGSAL
                     FROM EMP
                              NATURAL JOIN DEPT
                     WHERE DEPTNO = VDEPTNO
                     GROUP BY DEPTNO, DNAME)
            LOOP
                DBMS_OUTPUT.PUT_LINE('DNAME : ' || VEMP.DNAME);
                DBMS_OUTPUT.PUT_LINE('EMP_COUNT : ' || VEMPCOUNT);
                DBMS_OUTPUT.PUT_LINE('MAX_SAL : ' || VEMP.MAXSAL);
                DBMS_OUTPUT.PUT_LINE('AVG_SAL : ' || VEMP.AVGSAL);
            END LOOP;
    END IF;
END;
/
```



