## 8장. 서브 쿼리

8. **영업 사원들 보다 급여를 많이 받는 사원들의 이름과 급여와 직급(담당 업무)을 출력합니다.**

SELECT ENAME, SAL, JOB
FROM EMP
WHERE SAL > ALL (SELECT SAL FROM EMP WHERE JOB = 'SALESMAN');



9. **영업사원들의 최소 급여보다 많이 받는 사원들의 이름과 급여와 직급(담당업무)를 출력하되 영업사원은 출력하지 않습니다.**

SELECT ENAME, SAL, JOB
FROM EMP
WHERE SAL > ANY (SELECT SAL FROM EMP WHERE JOB = 'SALESMAN')
  AND JOB <> 'SALESMAN';



10. **SMITH와 동일한 직급을 가진 사원의 이름과 직급을 출력하라. (단일행 서브쿼리 사용)**

SELECT ENAME, JOB
FROM EMP
WHERE JOB = (select job
             from emp
             where ename = 'SMITH');



11. **직급인 'SALESMAN'인 사원이 받는 급여들의 최대 급여보다 많이 받는 사원들의 이름과 급여를 출력하되 부서번호가 20번인 사원은 제외한다.**

SELECT ENAME, SAL
FROM EMP
WHERE SAL > ALL (SELECT SAL FROM EMP WHERE JOB = 'SALESMAN')
  AND DEPTNO <> 20;



12. **직급이 'SALESMAN'인 사원이 받는 급여들의 최소 급여보다 많이 받는 사원들의 이름과 급여를 출력하되 부서번호가 20번인 사원은 제외한다.**

SELECT ENAME, SAL
FROM EMP
WHERE SAL > ANY (SELECT SAL FROM EMP WHERE JOB = 'SALESMAN')
  AND DEPTNO <> 20;



13. **부서별로 가장 급여를 많이 받는 사원의 정보(사원번호, 사원이름, 급여, 부서번호)를 출력하시오. (IN 연산자 이용)**

SELECT EMPNO, ENAME, SAL, DEPTNO
FROM EMP
WHERE (DEPTNO, SAL) IN (SELECT DEPTNO, MAX(SAL)
                        FROM EMP
                        GROUP BY DEPTNO)
ORDER BY SAL DESC;



---



## 9장. 테이블 구조 생성, 변경 및 삭제하는 DDL

1. **다음과 같은 구조의 테이블을 CREATE TABLE 명령어로 생성하되 테이블의 이름은 DEPT01로 하시오.**

CREATE TABLE
    DEPT01
(
    DEPTNO NUMBER(2),
    DNAME  VARCHAR2(14),
    LOC    VARCHAR2(13)
);



2. **EMP 테이블을 복사하되 사원번호, 사원이름, 급여 컬럼으로 구성된 테이블을 생성하시오.(테이블의 이름은 EMP04로 하시오.)**

CREATE TABLE EMP04
AS
SELECT EMPNO, ENAME, SAL
FROM EMP;



3. **DEPT 테이블과 동일한 구조의 빈 테이블을 생성하시오.(테이블의 이름은 DEPT02로 하시오.)**

CREATE TABLE DEPT02
AS
SELECT *
FROM DEPT
WHERE 1 = 0;



4. **DEPT02 테이블에 문자 타입의 부서장(DMGR) 칼럼을 추가해 봅시다.**

ALTER TABLE DEPT02
    ADD (DMGR VARCHAR2(10));



5. **DEPT02 테이블의 부서장(DMGR) 칼럼을 숫자 타입으로 변경해 봅시다.**

ALTER TABLE DEPT02
    MODIFY (DMGR NUMBER(4));



6. **DEPT02테이블의 부서장(DMGR) 컬럼을 삭제해 봅시다.**

ALTER TABLE DEPT02
    DROP COLUMN DMGR;



7. **DEPT02 테이블의 컬럼 LOC를 LOC2로 변경해 봅시다.**

ALTER TABLE DEPT02
    RENAME COLUMN LOC TO LOC2;



---



## 10장. 테이블의 내용 추가, 수정, 삭제하는 DML

1. **서브 쿼리문을 이용하여 다음과 같은 구조로 SAM01 테이블을 생성하시오. 존재할 경우 DROP TABLE로 삭제 후 생성하시오.**

CREATE TABLE SAM01
AS
SELECT EMPNO, ENAME, JOB, SAL
FROM EMP
WHERE 1 = 0;



2. **SAM01 테이블에 다음과 같은 데이터를 추가하시오.**

INSERT INTO SAM01
VALUES (1000, 'APPLE', 'POLICE', 10000);
INSERT INTO SAM01
VALUES (1010, 'BANANA', 'NURSE', 15000);
INSERT INTO SAM01
VALUES (1020, 'ORANGE', 'DOCTOR', 25000);



3. **문제1에서 생성한 SAM01 테이블에 다음과 같이 NULL값을 갖는 행을 추가하시오.**

INSERT INTO SAM01
VALUES (1030, 'VERY', NULL, 25000);
INSERT INTO SAM01
VALUES (1040, 'CAT', NULL, 2000);



4. **문제1에서 생성한 SAM01 테이블에 서브쿼리문을 사용하여 EMP에 저장된 사원 중 10번 부서 소속 사원의 정보를 추가하시오.**

INSERT INTO SAM01
SELECT EMPNO, ENAME, JOB, SAL
FROM EMP
WHERE DEPTNO = 10;



5. **SAM01 테이블에 저장된 사원 중 급여가 10000 이상인 사원들의 급여만 5000원씩 삭감하시오.**

UPDATE SAM01
SET SAL = SAL - 5000
WHERE SAL >= 10000;



6. **서브 쿼리문을 사용하여 EMP 테이블의 저장된 데이터의 특정 컬럼만으로 구성된 SAM02 테이블을 생성하시오. (데이터 추가합니다.)**

CREATE TABLE SAM02
AS
SELECT ENAME, SAL, HIREDATE, DEPTNO
FROM EMP;



7. **생성 후 DALLAS에 위치한 부서 소속 사원들의 급여를 1000 인상하시오.**

UPDATE SAM02
SET SAL = SAL + 1000
WHERE DEPTNO = (SELECT DEPTNO 
                FROM DEPT02 
                WHERE LOC = 'DALLAS');



8. **서브쿼리문을 사용하여 SAM02 테이블의 모든 사원의 급여와 입사일을 이름이 KING인 사원의 급여와 입사일로 변경하시오.**

UPDATE SAM02
SET (SAL, HIREDATE) = (SELECT SAL, HIREDATE 
                       FROM SAM02 
                       WHERE ENAME = 'KING');



9. **SAM01 테이블에서 직급이 정해지지 않은 사원을 삭제하시오.**

DELETE
FROM SAM01
WHERE JOB IS NULL;



10. **SAM02 테이블에서 RESEARCH 부서 소속 사원들만 삭제하시오.**

DELETE
FROM SAM02
WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE DNAME = 'RESEARCH');



---



## TEST 문제

1. 

CREATE TABLE JUMSU (
    NAME VARCHAR2(20),
    KOR NUMBER,
    ENG NUMBER,
    MAT NUMBER
);
INSERT INTO JUMSU VALUES ('박해영', 80, 90, 70);
INSERT INTO JUMSU VALUES ('김혜수', 75, 96, 80);
INSERT INTO JUMSU VALUES ('똘똘이', 95, 90, 85);



2. 

SELECT NAME, KOR, ENG, MAT
     , KOR + ENG + MAT AS 총점
     , ROUND((KOR + ENG + MAT) / 3) AS 평균
FROM JUMSU;



3. 

SELECT NAME
     , KOR
     , ENG
     , MAT
     , KOR + ENG + MAT              AS               총점
     , ROUND((KOR + ENG + MAT) / 3) AS               평균
     , RANK() OVER (ORDER BY (KOR + ENG + MAT) DESC) 등수
FROM JUMSU;



4. 

SELECT MAX(KOR), MAX(ENG), MAX(MAT)
FROM JUMSU;



5. 

1)

SELECT NAME, KOR AS "국어 최고 점수"
FROM JUMSU
WHERE KOR = (SELECT MAX(KOR) FROM JUMSU);

2)

SELECT NAME, ENG AS "영어 최고 점수"
FROM JUMSU
WHERE ENG = (SELECT MAX(ENG) FROM JUMSU);

3)

SELECT NAME, MAT AS "수학 최고 점수"
FROM JUMSU
WHERE MAT = (SELECT MAX(MAT) FROM JUMSU);



6. 

SELECT '국어' AS 과목, MAX(KOR) AS 점수
FROM JUMSU
UNION
SELECT '수학' AS 과목, MAX(MAT) AS 점수
FROM JUMSU
UNION
SELECT '영어' AS 과목, MAX(ENG) AS 점수
FROM JUMSU;



7.

SELECT '국어' AS 과목, NAME, KOR AS 점수
FROM JUMSU
WHERE KOR = (SELECT MAX(KOR) FROM JUMSU)
UNION
SELECT '수학' AS 과목, NAME, MAT AS 점수
FROM JUMSU
WHERE MAT = (SELECT MAX(MAT) FROM JUMSU)
UNION
SELECT '영어' AS 과목, NAME, ENG AS 점수
FROM JUMSU
WHERE ENG = (SELECT MAX(ENG) FROM JUMSU);



