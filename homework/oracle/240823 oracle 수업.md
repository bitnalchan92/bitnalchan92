## 20장. PLSQL 기초

1. **다음은 연봉을 구하는 예제입니다. 연봉 계산을 위해 “급여*12+커미션”이란 공식을 사용하겠습니다. (CH20_QUIZ_01.sql)**

```sql
SET SERVEROUTPUT ON
DECLARE
    VEMP   EMP%ROWTYPE;
    ANNSAL NUMBER(7, 2);
BEGIN
    DBMS_OUTPUT.PUT_LINE(RPAD('EMPNO', 7)
                         || RPAD('ENAME', 11)
                         -- || RPAD('SAL', 11)
                         -- || RPAD('COMM', 11)
                         || RPAD('ANNSAL', 11));

    DBMS_OUTPUT.PUT_LINE(RPAD('-', 28, '-'));

    SELECT *
    INTO VEMP
    FROM EMP
    WHERE ENAME = 'SCOTT';

    IF ( VEMP.COMM IS NULL ) THEN
        VEMP.COMM := 0;
    end if;

    ANNSAL := VEMP.SAL * 12 + VEMP.COMM;

    DBMS_OUTPUT.PUT_LINE(RPAD(VEMP.EMPNO, 7)
                         || RPAD(VEMP.ENAME, 11)
                         -- || RPAD(VEMP.SAL, 11)
                         -- || RPAD(VEMP.COMM, 11)
                         || RPAD(ANNSAL, 11));
END;
/
```



2. **다음은 BASIC LOOP문으로 5단을 출력하는 예제입니다. 빈칸을 채우세요. ( CH20_QUIZ_02.sql )**

```sql
SET SERVEROUTPUT ON

DECLARE
    DAN NUMBER := 5;
    I   NUMBER := 1;

BEGIN
    LOOP
        DBMS_OUTPUT.PUT_LINE(DAN || ' * ' || I || ' = ' || (DAN * I));

        I := I + 1;

        IF (I > 9) THEN
            EXIT;
        END IF;
    END LOOP;
END;
/
```



3. **다음은 FOR문으로 부서 번호를 계산한 후 이를 SELECT문의 WHERE절에 지정하여 부서 정보를 얻어오는 예입니다. 빈 공란을 채우시오. ( CH20_QUIZ_03.sql )**

```sql
SET SERVEROUTPUT ON

DECLARE
    VDEPT DEPT%ROWTYPE;
BEGIN
    DBMS_OUTPUT.PUT_LINE(RPAD('DEPTNO', 9)
        || RPAD('DNAME', 12)
        || RPAD('LOC', 14));

    DBMS_OUTPUT.PUT_LINE(RPAD('-', 32, '-'));

    FOR CNT IN 1..4
        LOOP
            SELECT *
            INTO VDEPT
            FROM DEPT
            WHERE DEPTNO = 10 * CNT;

            DBMS_OUTPUT.PUT_LINE(RPAD(VDEPT.DEPTNO, 9)
                || RPAD(VDEPT.DNAME, 12)
                || RPAD(VDEPT.LOC, 14));
        END LOOP;
END;
/
```



4. **다음은 WHILE LOOP 문으로 별을 삼각형 구도로 출력하는 예입니다. 빈 공란을 채우시오. ( CH20_QUIZ_04.sql )**

```sql
SET SERVEROUTPUT ON

DECLARE
    V_CNT NUMBER       := 1;
    V_STR VARCHAR2(10) := NULL;

BEGIN
    WHILE V_CNT <= 4
        LOOP
            V_STR := V_STR || '*';
            DBMS_OUTPUT.PUT_LINE(V_STR);

            V_CNT := V_CNT + 1;
        END LOOP;
END;
/
```



---



## 21장. 저장 프로시저 함수 커서

1. **사원명으로 검색하여 해당 사원의 직급을 얻어 오는 저장프로시저를 SEL_EMPNAME라는 이름으로 작성해 보십시오. ( CH21_QUIZ_01.sql )**

```sql
CREATE OR REPLACE PROCEDURE SEL_EMPNAME(
    VENAME IN EMP.ENAME%TYPE,
    VJOB OUT EMP.JOB%TYPE
)
    IS
BEGIN
    SELECT JOB
    INTO VJOB
    FROM EMP
    WHERE ENAME = VENAME;
END;
/
```



2. **사원명으로 검색하여 해당 사원의 직급을 얻어오는 저장 함수를 SEL_EMPNAME02라는 이름으로 작성해 보십시오. ( CH21_QUIZ_02.sql )**

```sql
CREATE OR REPLACE FUNCTION SEL_EMPNAME02(
    VENAME IN EMP.ENAME%TYPE)
    RETURN VARCHAR2
    IS
    VJOB EMP.JOB%TYPE;
BEGIN
    SELECT JOB
    INTO VJOB
    FROM EMP
    WHERE ENAME = VENAME;

    RETURN VJOB;
END;
/
```



3. **부서번호를 전달하여 해당 부서 소속 사원의 정보를 출력하는 SEL_EMP프로시저를 커서를 사용하여 작성해 보세요.**

```sql
CREATE OR REPLACE PROCEDURE SEL_EMP(
    VDEPTNO IN EMP.DEPTNO%TYPE
)
    IS
    VEMP      EMP%ROWTYPE;
    VEMPCOUNT NUMBER := 0;
    CURSOR C1
        IS
        SELECT EMPNO, ENAME, JOB, SAL
        FROM EMP
        WHERE DEPTNO = VDEPTNO;
BEGIN
    DBMS_OUTPUT.PUT_LINE(RPAD('EMPNO', 8)
        || RPAD('ENAME', 10)
        || RPAD('JOB', 10)
        || RPAD('SAL', 10));
    DBMS_OUTPUT.PUT_LINE(RPAD('-', 37, '-'));

    OPEN C1;

    LOOP
        FETCH C1 INTO VEMP.EMPNO, VEMP.ENAME, VEMP.JOB, VEMP.SAL;

        EXIT WHEN C1%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE(RPAD(VEMP.EMPNO, 8)
            || RPAD(VEMP.ENAME, 10)
            || RPAD(VEMP.JOB, 10)
            || RPAD(VEMP.SAL, 10));

        VEMPCOUNT := VEMPCOUNT + 1;
    END LOOP;

    DBMS_OUTPUT.PUT_LINE('There are ' || VEMPCOUNT || ' people in ' || 'dept ' || VDEPTNO || '.');
    CLOSE C1;
END;
/
```
