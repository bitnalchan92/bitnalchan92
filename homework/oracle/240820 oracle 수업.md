## 11장. 트랜잭션 관리

1. **트랜잭션 내용을 실제 DB에 저장하기 위해서는 ( )문을 사용합니다.**

COMMIT



2. **트랜잭션 내용을 취소하기 위해서는 ( )문을 사용하여 이전에 ( ) 한 부분까지 변경 전 데이터로 복구합니다.**

ROLLBACK, COMMIT



---



## 14장.

1. **기본 테이블은 EMP_COPY로 하여 20번 부서에 소속된 사원들의 사번과 이름과 부서번호와 상관의 사번을 출력하기 위한 SELECT문을 EMP_VIEW20이란 이름의 뷰로 정의해 봅시다.** 

CREATE VIEW EMP_VIEW20
AS
SELECT EMPNO, ENAME, DEPTNO, MGR
FROM EMP_COPY
WHERE DEPTNO = 20;



2. **각 부서별 최대 급여와 최소 급여를 출력하는 뷰를 SAL_VIEW 란 이름으로 작성하시오.**

CREATE VIEW SAL_VIEW
AS
SELECT DNAME, MAX(SAL) AS MAX_SAL, MIN(SAL) AS MIN_SAL
FROM EMP E
         NATURAL JOIN DEPT D
GROUP BY DNAME;



---



## 10장 문제 풀이 ( 8, 9번 )

8.

CREATE TABLE JUMSU2
AS SELECT * FROM JUMSU WHERE 1=0;

INSERT INTO JUMSU2 VALUES ('홍길동', 100, 100, 100);
INSERT INTO JUMSU2 VALUES ('박해영', 100, 100, 100);



9.

MERGE INTO JUMSU
USING JUMSU2
ON (JUMSU.NAME = JUMSU2.NAME)
WHEN MATCHED THEN
    UPDATE
    SET JUMSU.KOR = JUMSU2.KOR,
        JUMSU.ENG = JUMSU2.ENG,
        JUMSU.MAT = JUMSU2.MAT
WHEN NOT MATCHED THEN
    INSERT
    VALUES (JUMSU2.NAME, JUMSU2.KOR, JUMSU2.ENG, JUMSU2.MAT);



---



## 13장 문제 풀이

1. 

CREATE TABLE PARENT
(
    ID       VARCHAR2(20) PRIMARY KEY,
    PASSWORD VARCHAR2(12) NOT NULL,
    NAME     VARCHAR2(10) NOT NULL,
    BIRTHDAY DATE         NOT NULL
);



2. 

CREATE TABLE CHILD
(
    ID      VARCHAR2(20) REFERENCES PARENT (ID),
    ADDRESS VARCHAR2(20) default '서울시',
    GENDER  VARCHAR2(2) CHECK ( GENDER IN ('남', '여') )
)



3. 

-- 한글은 한글자당 3byte이기 때문에, 길이를 변경해주어야 한다. ( 1번문제에서 초기 테이블 생성시 10byte로 만들었음 )
-- ERROR at line 1: ORA-12899: value too large for column "SCOTT"."PARENT"."NAME" (actual: 12, maximum: 10)
ALTER TABLE PARENT
    MODIFY (NAME VARCHAR2(12));

INSERT INTO PARENT
VALUES ('abcd', '1234', '홍길동', '88/7/23');
INSERT INTO PARENT
VALUES ('bbbb', '5678', '신사임당', '85/11/01');
INSERT INTO PARENT
VALUES ('cccc', '90as', '성춘향', '93/12/15');
INSERT INTO PARENT
VALUES ('dddd', 'efgy', '리카엘', '92/05/01');
INSERT INTO PARENT
VALUES ('ffff', 'wjdgml', '김풍', '95/04/08');

-- CHILD.GENDER에는 '남' 또는 '여'가 들어가야 하는데 들어갈 컬럼의 길이가 짧기 때문에 먼저 길이를 3byte로 수정한다.
-- 그리고 insert를 문제에 나와있는 대로 수행해도 오류가 발생하는데, 이는 CHECK제약조건을 무시했기 때문이라, '남' 또는 '여'로 수정해야 한다.
ALTER TABLE CHILD
    MODIFY (GENDER VARCHAR2(3));

insert into child
values ('abcd', '경상북도', '남');
insert into child
values ('cccc', '퐁당시', '여');
insert into child
values ('dddd', '불가리아', '남');
insert into child
values ('ffff', '제주시', '남');
insert into child
values ('bbbb', '기품시', '여');
insert into child
values ('ffff', '제주시', '남');



4. 

SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME, SEARCH_CONDITION, R_CONSTRAINT_NAME
FROM USER_CONSTRAINTS
         NATURAL JOIN USER_CONS_COLUMNS
WHERE TABLE_NAME IN ('PARENT', 'CHILD');



5. 

SELECT TABLE_NAME, CONSTRAINT_NAME, COLUMN_NAME
FROM USER_CONS_COLUMNS
WHERE TABLE_NAME IN ('PARENT', 'CHILD');



6. 

-- 자식부터 DROP하는게 순서

DROP TABLE CHILD;
DROP TABLE PARENT;



7. 

SELECT TABLE_NAME                                                                            AS 자식테이블
     , COLUMN_NAME                                                                           AS 외래키
     , (SELECT TABLE_NAME FROM USER_CONS_COLUMNS WHERE CONSTRAINT_NAME = R_CONSTRAINT_NAME)  AS 부모테이블
     , (SELECT COLUMN_NAME FROM USER_CONS_COLUMNS WHERE CONSTRAINT_NAME = R_CONSTRAINT_NAME) AS 부모키
FROM USER_CONSTRAINTS
         NATURAL JOIN USER_CONS_COLUMNS
WHERE R_CONSTRAINT_NAME IS NOT NULL
  AND (TABLE_NAME LIKE 'EMP%' OR TABLE_NAME LIKE 'CHILD%');
